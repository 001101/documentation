# 报价

报价功能在[高级工具包](https://www.espocrm.com/extensions/advanced-pack/)里提供。

报价是指你就一定数量的、具体的产品组合或服务组合向客户报出的价格。

报价与“机会”有关。你可以在“管理”>“布局管理器”>“机会”>“关系”中将“报价”面板添加至“机会”细节视图。新建一份与一个机会相联系的报价就是将机会项目转移到这份报价上。

你可以将“报价”面板添加到“账户”的细节视图中，这样就可以看到相关的报价情况。你可以在“管理”>“布局管理器”>“账户”>“关系”中进行操作。

## 报价项目

报价包括一系列项目。一个项目可以表示一种特定产品或一项服务及其描述、数量、税率、定价和单价这些字段。你可以手动对多个项目进行排序。

你也可以用“实体管理器”为“报价项目”实体添加自定义字段。

## 模板

默认的情况下，有两套模板可以使用：“报价”模板和“发票”模板。对于模板，你可以新建模板（“报价”列表视图>右上角的下拉菜单>“模板”），也可以对现有的模板进行编辑。

如果你要进行更精确的编辑工作，推荐采用“代码视图”模式。

在模板中使用占位符，可以打印“报价”记录字段与相关记录字段。

如：
`{{accountName}}`——账户名，

`{{{billingAddressStreet}}}`——街道，

`{{account.type}}`——相关账户的类型，

`{{assignedUser.lastName}}`——指派用户的姓氏。

如果单个项目是一件产品，你可以对产品的字段进行打印。

如：
`{{product.length}}`、

`{{product.color}}`。

在上面的两个例子中，长度（length）和颜色（color）是“产品”实体的自定义字段。

报价项目的循环：

```
<!-- {{#each itemList}} -->
<td>{{order}}</td>
<td>{{name}}</td>
<td>{{quantity}}</td>
<td>{{product.weight}}</td>
<td align="right">{{listPrice}}</td>
<td align="right">{{unitPrice}}</td>
<td align="right">{{amount}}</td>
<!-- {{/each}} -->
```

可以打印图片字段：

```
<img src="{{file imageId}}">
```
其中的`imageId`是“报价”实体中自定义图像字段的名称，它带有后缀`Id`。

对于产品的单个项目：
```
<img src="{{file product.photoId}}">
```

要显示没有小数部分（如整数）的浮点数字（如数量、单价等），使用下列的表达式（从4.8.3版开始）：
```
{{numberFormat quantity_RAW decimals=0}}
```

对货币数值的格式进行自定义（自4.8.3版起）：
```
{{numberFormat unitPrice_RAW decimals=2 decimalPoint=',' thousandsSeparator=' '}}
```
值`10000.5`会被打印为`10 000,50`（千分位后有空格，小数点用英文逗号表示）。

显示多行的文本字段，要使用三层大括号包围它：`{{{description}}}`。

## 打印成PDF格式

报价可以打印成PDF格式。这项操作在报价细节视图中邻近“编辑”按钮的下拉菜单中。接着，系统就提示你去选择“模板”。

## 邮件报价

PDF格式的报价可以以附件的方式进行邮件发送。打开报价记录，点击邻近“编辑”按钮的下拉菜单，再点击“发PDF邮件”。

## 自动计数

你可以在“实体管理器”为“报价”实体类型创建一个“计数”字段。操作：“管理”>“实体管理器”>“报价”>“字段”>“添加字段”>“计数”。接着，在细节视图中使用“布局管理器”把它放进去。

这个计数值会随着每笔新报价的产生而递增。也可以为它指定下一个数字，还可以指定前缀。

## 默认的税务

这项功能始于EspoCRM 4.8.0版。

1. 在“管理”>“实体管理器”>“报价”>“字段”>“税收”>“默认”中指定默认“税收”记录。
2. 在“管理”>“实体管理器”>“报价”>“字段”>“税率”>“默认”中指定默认税率。

## 发票

如果报价的状态为`已通过`，报价就可以作为发票处理。这样， _发票开具日期_ 和 _发票号码_ 两个字段就会显示出来。打印发票时，可以使用不同的模板。

