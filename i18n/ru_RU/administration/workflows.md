# Workflows

Функция Workflows доступна в [Advanced Pack](https://www.espocrm.com/extensions/advanced-pack/)

Функция Workflows автоматизируют ваш бизнес-процесс простым способом. Вы можете найти ее на панели администрирования. Чтобы создать правило рабочего потока, вам необходимо определить:

* Целевую сущность - к какому типу бизнес-процесса объект применяется;
* Тип триггера - при срабатывании рабочего процесса;
* Условия - условия должны быть выполнены для запуска рабочего процесса;
* Действия - что необходимо делать, если рабочий процесс запускается


## Типы триггеров

### После создания записи

Выполняется только при создании новой записи. Если заданы указанные условия, то действия будут выполнены.

### После сохранения записи

Запускается при создании новой записи или обновлении существующей записи. Если заданы указанные условия, то действия будут выполнены.

Для правил рабочих процессов с этим типом триггера обычно принято соблюдать условие, которое проверяет, было ли какое-то поле «изменено». Например. Если статус Case изменен, выполните некоторые действия.

### Планирование

Выполняется в соответствии с заданным расписанием. Вы можете настроить его для запуска каждый день, каждую неделю и т. д. Действия будут применяться для записей, возвращаемых указанным списком отчетов. Поэтому вам также нужно создать отчет о списке.

Планирование указано в нотации crontab.

```
* * * * * *
| | | | | | 
| | | | | +-- Год              (range: 1900-3000)
| | | | +---- День недели      (range: 1-7, 1 standing for Monday)
| | | +------ Месяц года       (range: 1-12)
| | +-------- День месяца      (range: 1-31)
| +---------- Час              (range: 0-23)
+------------ Минута           (range: 0-59)
```

### Последовательные рабочие процессы

Используется редко. Предполагается, что будет работать другой рабочий процесс. Предоставляет возможность создавать комплексную логику.

Примечание: Для последовательных рабочих процессов рекомендуется использовать [инструмент BPM](bpm.md), а не функцию Workflow.

## Условия

Вы можете указать условия, которые должны выполняться для запуска рабочего процесса. Существует два способа определения условий: с компоновщиком условий пользовательского интерфейса и с формулой.

### Конструктор условий пользовательского интерфейса

Некоторые доступные типы условий:

* _equals_ - поле равно конкретному значению или значению другого поля;
* _ was equal_ - поле было равно определенному значению до запуска рабочего процесса;
* _not equals_ - поле не равно конкретному значению или значению другого поля;
* _ was not equal_ - поле не было равно конкретному значению до запуска рабочего процесса;
* _empty_ - значение поля пусто;
* _not empty_ - значение поля не пусто;
* _changed_ - поле было изменено;
* _not changed_ - поле не было изменено.

### Условия формулы

Формула дает возможность определять условия любой сложности. Чтобы прочитать синтаксис формулы, следуйте [этой статье](formula.md).

Примечание. В определении кода не должно быть никакого разделителя `;`, если он определяет условие.

## Действия

### Отправка писем

Система отправит электронное письмо с использованием указанного шаблона электронной почты. Адрес электронной почты получателя может быть взят из целевой записи, любой связанной записи, текущего пользователя, последователей, пользователей команды или который непосредственно Вами указан. Сообщение может быть отправлено незамедлительно или отложено на определенный временный интервал.

### Создать запись

Система создаст новую запись любого типа сущности. Если есть связь между целевой записью и созданием записи, можно связать записи.

Существует возможность определять формулу для вычисления полей.

### Создать связанную запись

Система создаст запись, относящуюся к целевой записи. Можно определить формулу для вычисления полей.

### Обновить целевую запись

Позволяет изменять определенные поля целевой записи. Можно определить формулу для вычисления полей.

Если вам нужно добавить новые элементы в поле Link-Multiple без потери существующих данных (например, для команд), вам необходимо использовать функцию function entity\addLinkMultipleId. Пример: `entity\addLinkMultipleId ('teams', 'teamId')`.

### Обновить соответствующую запись

Позволяет изменять определенные поля соответствующей записи или записей. Можно определить формулу для вычисления полей.

### Ссылка с другой записью

Связывает целевой объект с другим конкретным объектом. Например: добавляет конкретную команду к записи.

### Отменить связь с другой записью

Отделяет целевой объект от другого конкретного объекта. Например: удаляет определенную команду из записи.

### Применить правило назначения

Назначьте целевую запись пользователю по правилу распределения. Существуют два доступных правила: Round-Robin и Less-Busy.

* Round-Robin - пользователи выбираются из верхней части списка (команды), а затем снова начинают.
* Less-Busy - пользователь, у которого меньше назначенных записей, будет выбран для назначения.

_List Report_ - для распределения по Least-Busy определяется, какие записи будут приняты во внимание для расчета количества присвоенных записей. Например: для случаев нам нужно брать только записи с активным статусом.

### Создать уведомление

Уведомлять определенных пользователей с сообщением. В шаблоне сообщения можно использовать заполнители: {entity} - целевая запись, {user} - текущий пользователь.

### Функция Make Followed

Заставляет конкретных пользователей следовать за целевым объектом или конкретным связанным объектом.

### Запуск другого рабочего процесса

Позволяет создавать последовательные рабочие процессы. Можно разделить рабочий процесс по условию: вы можете настроить рабочий процесс для запуска двух рабочих процессов с разными условиями, определенными в этих рабочих процессах.

Можно отложить выполнение последовательного рабочего процесса. В последовательном wokflow вы можете определить условие, которое проверяет, были ли изменены поля спецификаций, поскольку родительский рабочий процесс был запущен с использованием типов условий _Changed_ и _Was Equal_.

Примечание. Для последовательных рабочих процессов рекомендуется использовать [BPM-инструмент](bpm.md), а не функцию Workflow.

### Запустить действие

Позволяет запускать определенные сценарии обслуживания. По умолчанию доступны следующие действия:

* Отправить приглашения - для встреч/звонков;
* Добавить цитату - для цитат.

Разработчики могут писать свои собственные служебные действия. См. [Подробнее](../ development/workflow-service-actions.md).

## Использование формул в действии

Можно определить формулу для вычисления полей для создания записи, обновления целевой записи, создания соответствующей записи, обновления соответствующей записи. Для последних двух, чтобы получить доступ к атрибутам целевого объекта, вы должны использовать функцию `targetEntity\attribute`. Чтобы получить доступ к атрибутам целевого объекта, который был установлен до запуска рабочего процесса, используйте функцию «targetEntity\attributeFetched».

Например:
```
name = string\concatenate(targetEntity\attribute('name'), ' ', datetime\today());
```
