# Workflows

Workflows คุณลักษณะที่มีอยู่ใน [Advanced Pack](https://www.espocrm.com/extensions/advanced-pack/).

Workflows ทำให้ขั้นตอนทางธุรกิจของคุณง่ายขึ้น คุณสามารถค้นหาได้ในแผงการดูแลระบบ ในการสร้างกฎ workflow คุณสามารถทำได้ดังนี้:

* Target Entity - ประเภทของ entity ที่ workflow ได้นำไปใช้;
* Trigger Type - เมื่อ workflow จะถูก triggered;
* Conditions - เงื่อนไขที่ต้องทำเพื่อเรียกใช้ workflow;
* Actions - ต้องทำอะไร ถ้าหาก workflow คือ triggered.


## ประเภทของ Trigger 

### หลังจากสร้างบันทึก

เรียกใช้เฉพาะเมื่อสร้างบันทึกใหม่เท่านั้น หากมีการระบุเงื่อนไขไว้การดำเนินการจะถูกดำเนินการ 

### หลังจากบันทึกถูกบันทึก

เรียกใช้เมื่อมีการสร้างหรือมีการปรับปรุงบันทึกที่มีอยู่ หากมีการระบุเงื่อนไขไว้การดำเนินการจะถูกดำเนินการ

สำหรับกฎของ workflow กับประเภทของ trigger นี้ เป็นเรื่องปกติที่จะมีเงื่อนไขที่จะตรวจสอบว่ามีบางฟิลด์หรือไม่ 'changed' เช่น หากสถานะ Case เปลี่ยนไปแล้วให้ดำเนินการบางอย่าง

### Scheduled

Triggered การกำหนดเวลาตามที่กำหนด คุณสามารถตั้งค่าการเรียกใช้งานทุกวัน,ทุกสัปดาห์ , ฯลฯ. การดำเนินการจะใช้กับบันทึกที่ส่งกลับมา โดยรายงานตามที่ระบุ ดังนั้นคุณต้องสร้างรายงานรายการด้วย

Scheduling ถูกระบุไว้ในสัญกรณ์ของ crontab

```
* * * * * *
| | | | | | 
| | | | | +-- Year              (range: 1900-3000)
| | | | +---- Day of the Week   (range: 1-7, 1 standing for Monday)
| | | +------ Month of the Year (range: 1-12)
| | +-------- Day of the Month  (range: 1-31)
| +---------- Hour              (range: 0-23)
+------------ Minute            (range: 0-59)
```

### Sequential

จะไม่ค่อยได้ใช้ ควรจะดำเนินการโดย workflow อื่น มีความสามารถในการสร้างตรรกะที่ซับซ้อน

หมายเหตุ: สำหรับ sequential workflows ขอแนะนำให้ใช้ [BPM tool](bpm.md) ไม่ใช่คุณลักษณะของ Workflows 

## เงื่อนไข

คุณสามารถระบุเงื่อนไขที่ต้องปฏิบัติตาม trigger  workflow ได้ โดยมีสองช่องทางที่เงื่อนไขสามารถระบุได้ : ด้วยตัวสร้างเงื่อนไข UI และด้วย formula

### ตัวสร้างเงื่อนไข UI

เงื่อนไขบางประเภทที่ใช้ได้:

* _equals_ - ฟิลด์ที่เท่ากับค่าเฉพาะหรือค่าของฟิลด์อื่น;
* _was equal_ - ฟิลด์ที่เท่ากับค่าที่ระบุก่อน workflow จะเป็น triggered;
* _not equals_ - ฟิลด์ที่ไม่เท่ากับค่าเฉพาะหรือค่าของฟิลด์อื่น
* _was not equal_ - ฟิลด์ที่ไม่เท่ากับค่าที่ระบุก่อน workflow จะเป็น triggered;
* _empty_ - ค่าของฟิลด์ว่างเปล่า;
* _not empty_ - ค่าของฟิลด์ไม่ว่างเปล่า;
* _changed_ - ฟิลด์มีการเปลี่ยนแปลง;
* _not changed_ - ฟิลด์ไม่มีการเปลี่ยนแปลง

### เงื่อนไขของ Formula

Formula ให้ความสามารถในการกำหนดเงื่อนไขของความซับซ้อนใด ๆ อ่านเกี่ยวกับ formula ได้ที่นี้ [this article](formula.md). 

หมายเหตุ: ไม่ควรมีตัวคั่น `;` ในรหัส formula เมื่อมีการกำหนดเงื่อนไข

## ข้อปฏิบัติ

### ส่งอีเมล

ระบบจะส่งอีเมลโดยใช้แม่แบบอีเมลที่ระบุ ที่อยู่อีเมลของผู้รับสามารถนำมาจากบันทึกเป้าหมาย้, บันทึกใด ๆ ที่เกี่ยวข้อง, ผู้ใช้ปัจจุบัน, ผู้ติดตาม, ทีมผู้ใช้หรือที่ระบุไว้ อีเมลสามารถส่งได้ทันทีหรือล่าช้าเป็นระยะเวลาหนึ่ง

### สร้างบันทึก

ระบบจะสร้างบันทึกใหม่ของ entity ประเภทใด ๆ ถ้ามีความสัมพันธ์ระหว่างบันทึกเป้าหมายกับการสร้างบันทึก มันเป็นไปได้ที่จะเกี่ยวข้องกับบันทึก

มีความสามารถในการกำหนดสูตรเพื่อคำนวณฟิลด์

### สร้างบันทึกที่เกี่ยวข้อง

ระบบจะสร้างบันทึกที่เกี่ยวข้องกับบันทึกเป้าหมาย มันเป็นไปได้ที่จะกำหนดสูตรเพื่อคำนวณฟิลด์

### อัปเดตบันทึกเป้าหมาย

ช่วยให้สามารถเปลี่ยนฟิลด์เฉพาะของบันทึกเป้าหมายได้ เป็นไปได้ที่จะกำหนดสูตรเพื่อคำนวณฟิลด์

หากต้องการเพิ่มรายการใหม่ลงในฟิลด์ Link-Multiple  w/o การสูญเสียข้อมูลที่มีอยู่ (เช่น ทีม) คุณต้องใช้ entity สูตรของฟังก์ชัน \addLinkMultipleId. ตัวอย่าง: `entity\addLinkMultipleId('teams', 'teamId')`.

### อัปเดตบันทึกที่เกี่ยวข้อง

อนุญาตให้มีการเปลี่ยนแปลงเฉพาะเขตข้อมูลของบันทึก หรือบันทึกที่เกี่ยวข้อง เป็นไปได้ที่จะกำหนดสูตรเพื่อคำนวณฟิลด์

### เชื่อมโยงกับบันทึกอื่นๆ

เชื่อมโยง entity เป้าหมายกับ entity เฉพาะอื่นๆ เช่น. เพิ่มทีมเฉพาะลงในบันทึก

### ยกเลิกการเชื่อมโยงกับบันทึกอื่นๆ

ไม่เชื่อมโยงกับ entity เป้าหมายจาก entity เฉพาะรายอื่นๆ เช่น. นำทีมเฉพาะออกจากบันทึก

### ใช้กฎการกำหนด

กำหนดบันทึกเป้าหมายให้กับผู้ใช้ตามกฎการแจกจ่าย มีกฎอยู่สองข้อคือ Round-Robin และ Least-Busy

* Round-Robin - ผู้ใช้จะถูกเลือกจากด้านบนลงด้านล่างของรายการ (ทีม) และจากนั้นจะเริ่มต้นอีกครั้ง
* Least-Busy - ผู้ใช้ที่มีบันทึกที่ได้รับมอบหมายน้อยกว่าจะได้รับเลือกสำหรับการมอบหมาย

_List Report_ - สำหรับการแจกจ่าย Least-Busy จะพิจารณาว่าบันทึกใดจะนำมาพิจารณาในการคำนวณจำนวนบันทึกที่ได้รับมอบหมาย เช่น สำหรับกรณีที่เราต้องใช้เฉพาะบันทึกที่มีสถานะใช้งานอยู่

### สร้างการแจ้งเตือน

แจ้งผู้ใช้เฉพาะที่มีข้อความ สามารถใช้ตัวยึดตำแหน่งในเทมเพลตข้อความได้: {entity} - บันทึกเป้าหมาย, {user} - ผู้ใช้ปัจจุบัน

### Make Followed

บังคับใช้ผู้ใช้เฉพาะติดตาม entity เป้าหมายหรือระบุ entity ที่เกี่ยวข้อง

### เรียกใช้กระบวนการทำงานอื่น

ช่วยให้สามารถทำ workflow ตามลำดับได้ เป็นไปได้ที่จะแบ่งสาขางานตามเงื่อนไข: คุณสามารถตั้งค่า workflow เพื่อเรียกใช้งาน workflow  สองประเภทที่มีเงื่อนไขต่างกันที่กำหนดไว้ใน workflow นั้น ๆ

อาจทำให้เกิดความล่าช้าในการดำเนินการ workflow ตามลำดับ ใน wokflow คุณสามารถกำหนดเงื่อนไขที่จะตรวจสอบว่าเขตข้อมูลเฉพาะมีการเปลี่ยนแปลงหรือไม่ เนื่องจาก wokflow หลักถูกเรียกใช้โดยใช้เงื่อนไข _changed และ _Was Equal_

หมายเหตุ: สำหรับ wokflow ตามลำดับขอแนะนำให้ใช้ [BPM tool] (bpm.md) แทนที่จะเป็นคุณลักษณะ wokflow 

### เรียกใช้บริการการดำเนินงาน

อนุญาตให้เรียกใช้สคริปต์บริการเฉพาะ โดยค่าเริ่มต้นมีการดำเนินการดังต่อไปนี้ให้บริการ:

* Send Invitations - สำหรับการประชุม / การโทร;
* Add Quote Items - สำหรับการให้คำปรึกษา

นักพัฒนาซอฟต์แวร์สามารถเขียนการดำเนินการบริการของตนเองได้ ดูจาก [more detail](../development/workflow-service-actions.md).

## การใช้สูตรในการดำเนินการ

เป็นไปได้ที่จะกำหนดสูตรคำนวณฟิลด์สำหรับสร้างบันทึก, อัปเดตบันทึกเป้าหมาย, สร้างบันทึกที่เกี่ยวข้อง, อัปเดตบันทึกที่เกี่ยวข้อง สำหรับสองสิ่งสุดท้าย, เพื่อเข้าถึง attributes ของ entity เป้าหมายคุณควรใช้ฟังก์ชัน `targetEntity\attribute` เพื่อเข้าถึง attributes ของ entity เป้าหมายที่ตั้งค่าไว้ก่อนที่ workflow จะมีการเรียกใช้ฟังก์ชัน `targetEntity\attributeFetched`.

ตัวอย่าง:
```
name = string\concatenate(targetEntity\attribute('name'), ' ', datetime\today());
```
